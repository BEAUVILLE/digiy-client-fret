<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>DIGIY FRET â€” Transport de marchandises</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#16a34a" />
  <meta name="description" content="DIGIY FRET â€” Colis, bagages, marchandises. Prix juste, chauffeur prÃ©sent." />

  <!-- CSS UNIQUEMENT ICI -->
  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,Arial,sans-serif;
      background:#f7fbf8;
      color:#0f172a;
    }
    header{
      background:#16a34a;
      color:#fff;
      padding:18px;
      text-align:center;
      font-weight:900;
      font-size:18px;
    }
    main{
      max-width:760px;
      margin:auto;
      padding:16px;
    }
    .card{
      background:#fff;
      border-radius:18px;
      padding:16px;
      margin-bottom:14px;
      box-shadow:0 10px 22px rgba(2,6,23,.08);
    }
    .actions{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    button{
      padding:14px;
      border:none;
      border-radius:14px;
      font-weight:900;
      cursor:pointer;
    }
    .accept{background:#16a34a;color:#fff}
    .secondary{background:#e5e7eb}
  </style>
</head>

<body>

<header>ğŸ“¦ DIGIY FRET â€” Chauffeur</header>

<main>

  <div class="card">
    <strong>ğŸ“ Dakar â†’ Plateau</strong><br>
    ğŸ“¦ Volume : L<br>
    â±ï¸ Urgence : 24H<br>
    ğŸ’° Prix base : 4 500 F CFA
  </div>

  <!-- BOUTONS CHAUFFEUR (AU BON ENDROIT) -->
  <div class="actions">
    <button class="accept">âœ… ACCEPTER</button>
    <button class="secondary">ğŸ•’ PROPOSER HEURE</button>
    <button class="secondary">ğŸ“… PROPOSER DEMAIN</button>
    <button class="secondary">ğŸ’° PROPOSER PRIX</button>
  </div>

</main>

</body>
</html>
   
<header>ğŸ“¦ DIGIY FRET <span class="pill">Client</span></header>

<main>

  <div class="card">
    <label>Ville</label>
    <input id="city" placeholder="Dakar, Saly, ThiÃ¨sâ€¦" value="Dakar" />

    <label>Type de chargement</label>
    <select id="tier">
      <option value="ENVELOPE">ğŸ“„ Enveloppe / petit paquet</option>
      <option value="COLIS" selected>ğŸ“¦ Colis / carton</option>
      <option value="BAGAGE">ğŸ§³ Bagages / plusieurs sacs</option>
      <option value="GROS">ğŸ—ï¸ Gros volume / marchandises</option>
    </select>

    <div class="grid">
      <div>
        <label>Distance estimÃ©e (km)</label>
        <input id="distance" type="number" step="0.1" value="4" />
      </div>
      <div>
        <label>DurÃ©e estimÃ©e (min)</label>
        <input id="duration" type="number" value="12" />
      </div>
    </div>

    <div class="row">
      <input type="checkbox" id="handling" />
      <label for="handling" style="margin:0">Besoin dâ€™aide (charger / dÃ©charger)</label>
    </div>

    <div class="grid">
      <div>
        <label>Ã‰tages (0â€“5)</label>
        <input id="stairs" type="number" min="0" max="5" value="0" />
      </div>
      <div class="row" style="align-items:flex-end;margin:0">
        <input type="checkbox" id="fragile" />
        <label for="fragile" style="margin:0">Fragile</label>
      </div>
    </div>

    <div class="price" id="price">â€”</div>

    <button class="btn secondary" onclick="estimate()">ğŸ§® Estimer le prix</button>
    <div class="note">Prix DIGIY garanti â€¢ Plancher inclus â€¢ Chauffeur rÃ©munÃ©rÃ© dignement</div>
  </div>

  <div class="card">
    <label>TÃ©lÃ©phone client</label>
    <input id="phone" placeholder="+2217XXXXXXX" />

    <label>Zone de dÃ©part</label>
    <input id="pickupZone" placeholder="Plateau, HLM, Saly Centreâ€¦" />

    <label>Zone dâ€™arrivÃ©e</label>
    <input id="dropoffZone" placeholder="Destinationâ€¦" />

    <button class="btn" onclick="createTrip()">ğŸ“¦ Commander FRET</button>
    <div class="note">Paiement direct au chauffeur â€¢ 0% commission DIGIY</div>
  </div>

</main>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

/* ğŸ” SUPABASE â€” DÃ‰JÃ€ POSÃ‰ */
    const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";


const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let lastPrice = null;

function getInputs(){
  return {
    city: document.getElementById("city").value.trim(),
    tier: document.getElementById("tier").value,
    distance: parseFloat(document.getElementById("distance").value || "0"),
    duration: parseInt(document.getElementById("duration").value || "0", 10),
    handling: document.getElementById("handling").checked,
    stairs: parseInt(document.getElementById("stairs").value || "0", 10),
    fragile: document.getElementById("fragile").checked,
    phone: document.getElementById("phone").value.trim(),
    pickupZone: document.getElementById("pickupZone").value.trim(),
    dropoffZone: document.getElementById("dropoffZone").value.trim()
  };
}

/* Estimation prix FRET */
window.estimate = async ()=>{
  const i = getInputs();

  const { data, error } = await supabase.rpc("estimate_fret_price", {
    p_city: i.city,
    p_tier: i.tier,
    p_distance_km: i.distance,
    p_duration_min: i.duration,
    p_handling: i.handling,
    p_stairs: i.stairs,
    p_fragile: i.fragile
  });

  if (error) {
    alert("Erreur estimation: " + error.message);
    return;
  }

  lastPrice = data;
  document.getElementById("price").innerText = data + " F CFA";
};

/* CrÃ©ation course FRET */
window.createTrip = async ()=>{
  const i = getInputs();

  if (!lastPrice) {
    alert("Estime le prix dâ€™abord.");
    return;
  }
  if (!i.phone) {
    alert("Mets ton tÃ©lÃ©phone.");
    return;
  }
  if (!i.pickupZone || !i.dropoffZone) {
    alert("Mets la zone de dÃ©part et dâ€™arrivÃ©e.");
    return;
  }

  const { data, error } = await supabase.rpc("create_trip", {
    p_client_phone: i.phone,
    p_pickup_city: i.city,
    p_pickup_zone: i.pickupZone,
    p_pickup_lat: null,
    p_pickup_lng: null,
    p_dropoff_city: i.city,
    p_dropoff_zone: i.dropoffZone,
    p_dropoff_lat: null,
    p_dropoff_lng: null,
    p_distance_km: i.distance,
    p_duration_min: i.duration,
    p_service_type: "FRET"
  });

  if (error) {
    alert("Erreur crÃ©ation: " + error.message);
    return;
  }

  alert("âœ… Course FRET crÃ©Ã©e ! ID: " + data);
};
</script>

</body>
</html>
