<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>DIGIY FRET ‚Äî Transport de marchandises</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#16a34a" />
  <meta name="description" content="DIGIY FRET ‚Äî Colis, bagages, marchandises. Prix juste, chauffeur pr√©sent." />

  <!-- CSS UNIQUEMENT ICI -->
  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,Arial,sans-serif;
      background:#f7fbf8;
      color:#0f172a;
    }
    header{
      background:#16a34a;
      color:#fff;
      padding:18px;
      text-align:center;
      font-weight:900;
      font-size:18px;
    }
    main{
      max-width:760px;
      margin:auto;
      padding:16px;
    }
    .card{
      background:#fff;
      border-radius:18px;
      padding:16px;
      margin-bottom:14px;
      box-shadow:0 10px 22px rgba(2,6,23,.08);
    }
    .actions{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    button{
      padding:14px;
      border:none;
      border-radius:14px;
      font-weight:900;
      cursor:pointer;
    }
    .accept{background:#16a34a;color:#fff}
    .secondary{background:#e5e7eb}
  </style>
</head>

<body>

<header>üì¶ DIGIY FRET ‚Äî Chauffeur</header>

<main>

  <div class="card">
    <strong>üìç Dakar ‚Üí Plateau</strong><br>
    üì¶ Volume : L<br>
    ‚è±Ô∏è Urgence : 24H<br>
    üí∞ Prix base : 4 500 F CFA
  </div>

  <!-- BOUTONS CHAUFFEUR (AU BON ENDROIT) -->
  <div class="actions">
    <button class="accept">‚úÖ ACCEPTER</button>
    <button class="secondary">üïí PROPOSER HEURE</button>
    <button class="secondary">üìÖ PROPOSER DEMAIN</button>
    <button class="secondary">üí∞ PROPOSER PRIX</button>
  </div>

</main>

</body>
</html>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Arial,sans-serif;background:#f7fbf8;color:#0f172a}
    header{background:#16a34a;color:#fff;padding:18px;text-align:center;font-weight:900;font-size:18px}
    main{max-width:760px;margin:auto;padding:16px}
    .card{background:#fff;border-radius:18px;box-shadow:0 10px 22px rgba(2,6,23,.08);padding:16px;margin-bottom:14px}
    label{font-size:12px;font-weight:800;color:#475569;display:block;margin-bottom:6px}
    input,select{width:100%;padding:12px;border-radius:14px;border:1px solid rgba(15,23,42,.15);font-size:15px;margin-bottom:14px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:640px){.grid{grid-template-columns:1fr}}
    .row{display:flex;align-items:center;gap:10px;margin:8px 0}
    .row input[type="checkbox"]{width:auto;margin:0;transform:scale(1.2)}
    .price{font-size:28px;font-weight:950;color:#065f46;text-align:center;margin:10px 0}
    .btn{width:100%;padding:16px;border:none;border-radius:16px;background:#16a34a;color:#fff;font-weight:950;font-size:16px;cursor:pointer}
    .btn.secondary{background:#0ea5e9}
    .note{font-size:13px;color:#475569;text-align:center;margin-top:10px}
    .pill{display:inline-block;background:#eafff3;border:1px solid rgba(22,163,74,.25);padding:6px 10px;border-radius:999px;font-weight:900;color:#065f46;font-size:12px}
  </style>
</head>

<body>
<header>üì¶ DIGIY FRET <span class="pill">Client</span></header>

<main>

  <div class="card">
    <label>Ville</label>
    <input id="city" placeholder="Dakar, Saly, Thi√®s‚Ä¶" value="Dakar" />

    <label>Type de chargement</label>
    <select id="tier">
      <option value="ENVELOPE">üìÑ Enveloppe / petit paquet</option>
      <option value="COLIS" selected>üì¶ Colis / carton</option>
      <option value="BAGAGE">üß≥ Bagages / plusieurs sacs</option>
      <option value="GROS">üèóÔ∏è Gros volume / marchandises</option>
    </select>

    <div class="grid">
      <div>
        <label>Distance estim√©e (km)</label>
        <input id="distance" type="number" step="0.1" value="4" />
      </div>
      <div>
        <label>Dur√©e estim√©e (min)</label>
        <input id="duration" type="number" value="12" />
      </div>
    </div>

    <div class="row">
      <input type="checkbox" id="handling" />
      <label for="handling" style="margin:0">Besoin d‚Äôaide (charger / d√©charger)</label>
    </div>

    <div class="grid">
      <div>
        <label>√âtages (0‚Äì5)</label>
        <input id="stairs" type="number" min="0" max="5" value="0" />
      </div>
      <div class="row" style="align-items:flex-end;margin:0">
        <input type="checkbox" id="fragile" />
        <label for="fragile" style="margin:0">Fragile</label>
      </div>
    </div>

    <div class="price" id="price">‚Äî</div>

    <button class="btn secondary" onclick="estimate()">üßÆ Estimer le prix</button>
    <div class="note">Prix DIGIY garanti ‚Ä¢ Plancher inclus ‚Ä¢ Chauffeur r√©mun√©r√© dignement</div>
  </div>

  <div class="card">
    <label>T√©l√©phone client</label>
    <input id="phone" placeholder="+2217XXXXXXX" />

    <label>Zone de d√©part</label>
    <input id="pickupZone" placeholder="Plateau, HLM, Saly Centre‚Ä¶" />

    <label>Zone d‚Äôarriv√©e</label>
    <input id="dropoffZone" placeholder="Destination‚Ä¶" />

    <button class="btn" onclick="createTrip()">üì¶ Commander FRET</button>
    <div class="note">Paiement direct au chauffeur ‚Ä¢ 0% commission DIGIY</div>
  </div>

</main>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

/* üîê SUPABASE ‚Äî D√âJ√Ä POS√â */
    const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";


const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let lastPrice = null;

function getInputs(){
  return {
    city: document.getElementById("city").value.trim(),
    tier: document.getElementById("tier").value,
    distance: parseFloat(document.getElementById("distance").value || "0"),
    duration: parseInt(document.getElementById("duration").value || "0", 10),
    handling: document.getElementById("handling").checked,
    stairs: parseInt(document.getElementById("stairs").value || "0", 10),
    fragile: document.getElementById("fragile").checked,
    phone: document.getElementById("phone").value.trim(),
    pickupZone: document.getElementById("pickupZone").value.trim(),
    dropoffZone: document.getElementById("dropoffZone").value.trim()
  };
}

/* Estimation prix FRET */
window.estimate = async ()=>{
  const i = getInputs();

  const { data, error } = await supabase.rpc("estimate_fret_price", {
    p_city: i.city,
    p_tier: i.tier,
    p_distance_km: i.distance,
    p_duration_min: i.duration,
    p_handling: i.handling,
    p_stairs: i.stairs,
    p_fragile: i.fragile
  });

  if (error) {
    alert("Erreur estimation: " + error.message);
    return;
  }

  lastPrice = data;
  document.getElementById("price").innerText = data + " F CFA";
};

/* Cr√©ation course FRET */
window.createTrip = async ()=>{
  const i = getInputs();

  if (!lastPrice) {
    alert("Estime le prix d‚Äôabord.");
    return;
  }
  if (!i.phone) {
    alert("Mets ton t√©l√©phone.");
    return;
  }
  if (!i.pickupZone || !i.dropoffZone) {
    alert("Mets la zone de d√©part et d‚Äôarriv√©e.");
    return;
  }

  const { data, error } = await supabase.rpc("create_trip", {
    p_client_phone: i.phone,
    p_pickup_city: i.city,
    p_pickup_zone: i.pickupZone,
    p_pickup_lat: null,
    p_pickup_lng: null,
    p_dropoff_city: i.city,
    p_dropoff_zone: i.dropoffZone,
    p_dropoff_lat: null,
    p_dropoff_lng: null,
    p_distance_km: i.distance,
    p_duration_min: i.duration,
    p_service_type: "FRET"
  });

  if (error) {
    alert("Erreur cr√©ation: " + error.message);
    return;
  }

  alert("‚úÖ Course FRET cr√©√©e ! ID: " + data);
};
</script>

</body>
</html>
